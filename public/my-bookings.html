<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>My Bookings</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">


<div class="max-w-5xl mx-auto px-6 py-10">


<header class="mb-8">
<h1 class="text-3xl font-semibold text-gray-900">My Booth Bookings</h1>
<p class="text-gray-600 mt-2">View your current and upcoming library booth reservations.</p>
</header>


<div id="error" class="hidden mb-6 p-4 rounded bg-red-100 text-red-700"></div>


<div class="bg-white shadow rounded-lg overflow-hidden">
<table class="min-w-full divide-y divide-gray-200">
<thead class="bg-gray-50">
<tr>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Booth</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Start</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">End</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
</tr>
</thead>
<tbody id="bookings" class="bg-white divide-y divide-gray-200"></tbody>
</table>
</div>


</div>


<script>
const userId = sessionStorage.getItem('user_id');
const errorEl = document.getElementById('error');
const tbody = document.getElementById('bookings');


if (!userId) {
errorEl.textContent = 'No active session. Please identify yourself first.';
errorEl.classList.remove('hidden');
} else {
fetch(`/api/users/${userId}/bookings`)
.then(res => {
if (!res.ok) throw new Error('Failed to load bookings');
return res.json();
})
.then(bookings => {
if (bookings.length === 0) {
tbody.innerHTML = `
<tr>
<td colspan="4" class="px-6 py-6 text-center text-gray-500">No bookings found</td>
</tr>`;
return;
}


bookings.forEach(b => {
const statusColour = b.status === 'active'
? 'bg-green-100 text-green-800'
: b.status === 'cancelled'
? 'bg-red-100 text-red-800'
: 'bg-gray-100 text-gray-800';


const row = document.createElement('tr');
row.innerHTML = `
<td class="px-6 py-4 font-medium text-gray-900">${b.booth_code}</td>
<td class="px-6 py-4 text-gray-700">${b.start_time}</td>
<td class="px-6 py-4 text-gray-700">${b.end_time}</td>
<td class="px-6 py-4">
<span class="inline-flex px-3 py-1 text-sm font-medium rounded-full ${statusColour}">
${b.status}
</span>
</td>
`;
tbody.appendChild(row);
});
})
.catch(err => {
errorEl.textContent = err.message;
errorEl.classList.remove('hidden');
});
}
</script>
</body>
</html>
